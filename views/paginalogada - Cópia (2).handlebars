<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/style2.css" />
    <link rel="stylesheet" href="/css/style-Ran.css" />
    <link rel="stylesheet" href="/css/style-form.css" />
    <link rel="stylesheet" href="/css/pagBase.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <title>Operaçao Limpeza - Usuário</title>
</head>

<body>

    <ul id="menu-user">
        <li>
            <div class="container-usuarios">
                Olá, {{user.nome}}
            </div>
        </li>
        <li>
            <form action="/logout" method="post">
                <button class="botao_sair" type="submit">
                    <span class="icone fa-icon fa-sign-out"></span> <!-- Define icone para o botão -->
                    Sair
                </button>
            </form>
        </li>
    </ul>

    <div class="section">
        <div class="container-top">
        <div>
            <p>
                <span class="login-form-title">
                    O que você deseja?
                </span>
            </p>
            <hr>
            <table>
                <tbody>
                    <tr>
                        <td width="25">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/7/72/Disambig.svg" width="35"
                                height="28">
                        </td>
                        <td class="info">
                            Escolha uma das opções abaixo.
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div class="centralizar disposicao_conteudo" >
            <div id="div1-login-form" class="divs active">
                <!--Botoes da tala inicial logada-->
                <button class="botao botao_blue-50" onclick="showForm('cadastroProblemaForm')">Cadastrar
                    Problema</button>
                </br>
                <button class="botao botao_blue-50" onclick="showTable()">Visualizar Problemas</button>
            </div>
            </div>
        </div>

        <!--Formulário-->
        <main>
            <!--Botão(home) fechar telas Form/Table, agora obsoleto!-->
            <button onclick="home()" id="home" style="display: none;">home</button>

            <!--Esta div contem o NOVO formulário para cadastro de problmas-->
            <div class="container-formulario col-12 mt-3 mt-md-0 p-0 col-lg-6" id="cadastroProblemaForm" style="display: none;>
                <div class="d-block col-12 col-md-11 m-auto">

                            <!--Formulário de cadastro de problemas-->
                            <form action="/enviar-formulario" method="post" enctype="multipart/form-data">
            
                                <span class="info">
                                    <p class="login-form-title">
                                        Cadastro de problemas.
                                        <hr>
                                    </p <p>
                                    Preencha os campos abaixo para informar o problema.</br>
                                    Campos com * são obrigatórios.
                                    </p>
                                </span>

                                <div class="borda_red-20 borda_arredond-8">

                                    <div class="mt-2">
                                        
                                        <div class="form-row mt-3">
                                            <div class="col-md-6 col-12">
                                                <label for="endereco">* Endereço:</label>
                                                <input class="form-control" type="text" id="end_ocorrencia" name="end_ocorrencia" maxlength="100" required placeholder="Informe o endereco" />
                                            </div>
                                            
                                            <div class="col-md-4 col-12">
                                                <label for="bairro">* Bairro:</label>
                                                <input class="form-control" type="text" id="bairro" name="bairro" maxlength="50" required placeholder="Informe o bairro" />
                                            </div>
                                            
                                            <div class="col-md-2 col-12">
                                                <label for="cep">* CEP:</label>
                                                <input class="form-control" type="text" id="cep" name="cep" maxlength="8" required placeholder="Ex.: 99999999" />
                                            </div>
                                            
                                        </div>
                                            
                                            
                                        <div class="form-row mt-2">
                                            <div class="col-md-4 col-sm-12">
                                                <label class="pl-2">* Gravidade da Ocorrência:</label>
                                                <div class="w-100 d-block d-md-flex my-2">
                                                
                                                    <div class="col-sm-12 col-md-2 my-2 my-md-0">
                                                        <input class="form-control" type="radio" name="gravidade_da_ocorrencia" value="Baixa" required />
                                                        <label tabindex="0" for="Baixa">Baixa</label>
                                                        
                                                    </div>
                                                    
                                                    <div class="col-sm-12 col-md-2 my-2 my-md-0">
                                                        <input class="form-control" type="radio" name="gravidade_da_ocorrencia" value="Media" required />
                                                        <label tabindex="0" for="Media">Media</label>
                                                    
                                                    </div>
                                                    
                                                    <div class="col-sm-12 col-md-2 my-2 my-md-0">
                                                        <input class="form-control" type="radio" name="gravidade_da_ocorrencia" value="Alta" required />
                                                        <label tabindex="0" for="Alta">Alta</label>
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-8 col-sm-12">
                                                <label for="descricao">* Descrição da Ocorrência:</label>
                                                <textarea class="form-control container-label" id="descricao_da_ocorrencia" name="descricao_da_ocorrencia" required="" maxlength="255" placeholder="Ex.: Buraco de um metro de largura, dois de prufundidade, localizado na rua Pêra, na altura do número 4."></textarea>
                                            </div>
                                            
                                        </div>
                                            

                                            
                                        <div class="form-row">
                                            <div class="col-md-6 col-sm-12">
                                                <label for="foto-ocorrencia">* Foto da Ocorrência:</label>
                                                <input class="form-control" type="file" id="foto_da_ocorrencia" name="foto_da_ocorrencia" accept="image/*" required />

                                            </div>
                                            
                                            <div class="col-md-6 col-sm-12">
                                                <label for="foto-mapa">* Mapa da Ocorrência:</label>
                                                <input class="form-control" type="file" id="foto_mapa_da_localizacao" name="foto_mapa_da_localizacao" accept="image/*" />
                                            </div>
                                        </div>
                                            
                                        <div class="form-row">
                                            <div class="col-md-6 col-sm-12">
                                                <button onclick="home()" class="mt-2 w-100 botao botao_red-40">Cancelar</button>
                                            </div>
                                            
                                            <div class="col-md-6 col-sm-12">
                                                <button type="submit" id="btn-cadastrar" class="mt-2 w-100 botao botao_blue-50">Enviar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                </div>
            </div>

           

            {{!-- <div class="tabelaproblema" id="tabelaProblema">
                <h2>PROBLEMAS NAS VIAS</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID-Ocorrência</th>
                            <th>Descrição</th>
                            <th>Status</th>
                            <th>Foto</th>
                            <th>Detalhes/Solução</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each problemas}}
                        <tr>
                            <td>{{this.id_ocorrencia}}</td>
                            <td>{{this.descricao_da_ocorrencia}}</td>
                            <td>{{this.status_da_ocorrencia}}</td>
                            <td>
                                <img src="{{this.foto_da_ocorrencia}}" alt="Foto da Ocorrência"
                                    style="width: 65px; height: 40px;" />
                            </td>
                            <td class="acoes">
                                <button onclick="showPopupsolucao('{{this.id_ocorrencia}}')">Solução</button>
                                <button onclick="showPopuproblemas('{{this.id_ocorrencia}}')">Detalhes</button>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div> --}}

            <!--Esta seção mostra problemas cadastrados-->
            <div class="borda_green-40 borda_preenchimento borda_arredond-8 sombra area_conteudo margem_topo-2" style="display: none;>
                <div class="tabelaproblema" id="tabelaProblema">
                    <span class="info">
                        <p class="login-form-title">
                            Visualização da situação(status).                                       <hr>
                        </p <p>
                            Visualização da situação(status) de problemas cadastrados por você.</br>
                        </p>
                    </span>
                    <!--Esta dov contem a estrutura que mostra daca linha para cada cadastro -->
                    <div class="borda_red-20 borda_arredond-8">
                        <div class="problema-container ">
                            {{#each problemas}}
                            <div class="problema-item borda_gray-30">
                                <div class="problema-info">
                                    <p><strong>ID-Ocorrência:</strong> {{this.id_ocorrencia}}</p>
                                    <p><strong>Descrição:</strong> {{this.descricao_da_ocorrencia}}</p>
                                    <p class="status"><strong>Status:</strong> {{this.status_da_ocorrencia}}</p>
                                </div>
                                <div class="problema-foto">
                                    <img src="{{this.foto_da_ocorrencia}}" alt="Foto da Ocorrência" class="img-problema" />
                                </div>
                                <div class="problema-acoes">
                                    <button onclick="showPopupsolucao('{{this.id_ocorrencia}}')">Visualizar</button>
                                    <button onclick="showPopuproblemas('{{this.id_ocorrencia}}')">Ver Detalhes</button>
                                </div>
                            </div>
                            {{/each}}
                        </div>
                        <div class="centralizar">
                        <!--Botão fechar telas Form/Table para fechar telas em paginalogada-->
                        <button class="botao botao_red-40" onclick="home()">Fechar</button>
                        </div>
                    </div>
                </div>
                <div id="popupDivFundo" class="fundo" style="display: none;"></div>
               
            </div>


            
                <!-- Mostra solução para um problema quando o botão Visualizar(em status) é clicado -->
                <div class="borda_green-40 borda_preenchimento borda_arredond-8 sombra area_conteudo margem_topo-3 margem_topo popupContainerSolucao" id="popupContainerSolucao" style="display: none;">
                    
                    <span class="info">
                        <p class="login-form-title">
                            Descrição da solução.                                       
                            <hr>
                        </p
                        <p>
                            Veja a descrição da solução para o problema acompanhada de uma foto da solução.
                            </br>
                        </p>
                    </span>



                    <div class="borda_red-20 borda_arredond-8">
                        <div class="solucoes-container">
                            <!-- Loop para cada solução -->
                            {{#each problemas}}
                            <!-- supondo que você tenha um array de solucoes -->
                            <div class="solucao-item borda_gray-30" data-id="{{this.id_ocorrencia}}">
                                <div class="descricao-solucao">
                                    <p><strong>Descrição da Solução:</strong> {{this.descricao_solucao}}</p>
                                </div>
                                <div class="foto-solucao">
                                    <!-- Expanda a imagem da solução -->
                                    <a href="#imagemSolucao{{this.id_ocorrencia}}">
                                        <img src="{{this.foto_da_solucao}}" alt="Foto da Solução" class="img-solucao" />
                                    </a>
                                </div>
                            </div>

                            <!-- Conteúdo da imagem expandida para a solução -->
                            <div class="imagem-expandida" id="imagemSolucao{{this.id_ocorrencia}}">
                                <img src="{{this.foto_da_solucao}}" alt="Foto da Solução" />
                                <a href="#" class="fechar">&#x2716;</a>
                            </div>

                            {{/each}}
                            <!-- Fim do loop -->
                        </div>
                        <div class="centralizar">
                            <span class="botao botao_red-40" onclick="closePopupsolucao()">Fechar</span>
                        </div>
                    </div>
                </div>


            <!-- Mostra os detalhes do problema cadastrado quando o botão Detalhes é clicado? DEVERIA VOLTAR EM UMA TELA COMO A DE DADASTRO, PORÉM, COM OS DADOS CADASTRADOS PREENCHIDOS 
            <div id="popupContainerproblemas" class="popupContainerproblemas" style="display: none;">-->
            <div class="borda_green-40 borda_preenchimento borda_arredond-8 sombra area_conteudo margem_topo-3 margem_topo popupContainerSolucao" id="popupContainerproblemas" style="display: none;">
                    
                    <span class="info">
                        <p class="login-form-title">
                            Detalhes do problema cadastrado.                                       
                            <hr>
                        </p
                        <p>
                            Veja abaixo detalhes do problema cadastrado.
                            </br>
                        </p>
                    </span>    
                                    
                <div class="vertical-list">
                    {{#each problemas}}
                    <div class="item" data-id="{{this.id_ocorrencia}}">
                        <p><strong>ID-Ocorrência:</strong> {{this.id_ocorrencia}}</p>
                        <p><strong>ID-Usuário:</strong> {{this.id_usuario}}</p>
                        <p><strong>Gravidade:</strong> {{this.gravidade_da_ocorrencia}}</p>
                        <p><strong>Endereço:</strong> {{this.end_ocorrencia}}</p>
                        <p><strong>Bairro:</strong> {{this.bairro}}</p>
                        <p><strong>Descrição:</strong> {{this.descricao_da_ocorrencia}}</p>
                        <p><strong>Foto da Ocorrência:</strong> <a href="#imagem{{this.id_ocorrencia}}"><img
                                    src="{{this.foto_da_ocorrencia}}" alt="Foto da Ocorrência"
                                    style="max-width: 50px; max-height: 50px;" /></a></p>
                        <p><strong>Foto do Mapa:</strong> <a href="#mapa{{this.id_ocorrencia}}"><img
                                    src="{{this.foto_mapa_da_localizacao}}" alt="Foto do Mapa"
                                    style="max-width: 75px; max-height: 75px;" /></a></p>
                        <div class="imagem-expandida" id="imagem{{this.id_ocorrencia}}">
                            <img src="{{this.foto_da_ocorrencia}}" alt="Foto da Ocorrência" />
                            <a href="#" class="fechar">&#x2716;</a>
                        </div>
                        <div class="imagem-expandida" id="mapa{{this.id_ocorrencia}}">
                            <img src="{{this.foto_mapa_da_localizacao}}" alt="Foto do Mapa" />
                            <a href="#" class="fechar">&#x2716;</a>
                        </div>
                    </div>
                    {{/each}}
                </div>
                <span class="closeBtn" onclick="closePopuproblemas()">Fechar</span>
            </div>

        </main>

        <script>
            function showForm(formId) {
                //mostra botao home
                document.getElementById('home').style.display = 'flex';

                const forms = document.querySelectorAll('.container-formulario');
                forms.forEach(form => {
                    if (form.id === formId) {
                        form.style.display = 'flex';
                    } else {
                        form.style.display = 'none';
                    }
                });

                const tabelaProblema = document.getElementById('tabelaProblema');
                if (formId === 'cadastroProblemaForm') {
                    tabelaProblema.style.display = 'none';
                } else {
                    tabelaProblema.style.display = 'flex';
                }

                const formCadsolucao = document.getElementById('cadastroSolucaoForm');
                if (formId === 'cadastroSolucaoForm') {
                    formCadsolucao.style.display = 'flex';
                } else {
                    formCadsolucao.style.display = 'none';
                }

                // Oculta a tabela de soluções quando mudar de formulário
                const popupContainerSolucao = document.getElementById('popupContainerSolucao');
                popupContainerSolucao.style.display = 'none';
                //esconde botao home
                document.getElementById('home').style.display = 'flex ';
            }

            function showTable() {
                //mostra botao home
                document.getElementById('home').style.display = 'flex ';
                const forms = document.querySelectorAll('.container-formulario');
                forms.forEach(form => {
                    form.style.display = 'none';
                });

                const tabelaProblema = document.getElementById('tabelaProblema');
                tabelaProblema.style.display = 'block';

                const formCadsolucao = document.getElementById('cadastroSolucaoForm');
                formCadsolucao.style.display = 'none';

                // Oculta a tabela de soluções quando clicar em visualizar problemas
                const popupContainerSolucao = document.getElementById('popupContainerSolucao');
                popupContainerSolucao.style.display = 'none';


            }
            function home() {
                // Esconde todos os elementos conforme 

                document.getElementById('cadastroProblemaForm').style.display = 'none';
                document.getElementById('tabelaProblema').style.display = 'none';
                //esconde botao home
                document.getElementById('home').style.display = 'none ';
            }

            function showPopuproblemas(id_ocorrencia) {
                var popup = document.getElementById("popupContainerproblemas");
                popup.style.display = "flex";

                // Ocultar todas as tabelas inicialmente
                var allTables = document.querySelectorAll("#popupContainerproblemas .item");
                allTables.forEach(table => {
                    table.style.display = "none";
                });

                // Exibir apenas a tabela relevante com base no id_ocorrencia
                var targetTable = document.querySelector(`#popupContainerproblemas .item[data-id="${id_ocorrencia}"]`);
                if (targetTable) {
                    targetTable.style.display = "flex";
                }
            }

            function closePopuproblemas() {
                var popup = document.getElementById("popupContainerproblemas");
                popup.style.display = "none";
            }


            function showPopupsolucao(id_ocorrencia) {
                // console.log("Chamada da função showPopupsolucao com ID de ocorrência:", id_ocorrencia);
        
                var popup = document.getElementById("popupContainerSolucao");
                popup.style.display = "block";
               
               //Controla a div com class="fundo" quando o botão Visualizar é clicado
                var popupDiv = document.getElementById('popupDivFundo');
                popupDiv.style.display = 'block';

                // Ocultar todos os itens de solução inicialmente
                var solucoes = document.querySelectorAll("#popupContainerSolucao .solucao-item");
                solucoes.forEach(function (solucao) {
                    solucao.style.display = "none";
                });

                // Exibir apenas o item de solução correspondente ao ID da ocorrência
                var solucaoEspecifica = document.querySelector(`#popupContainerSolucao .solucao-item[data-id="${id_ocorrencia}"]`);
                if (solucaoEspecifica) {
                    solucaoEspecifica.style.display = "flex"; //
                } else {
                    // console.warn(`Nenhuma solução encontrada para a ocorrência com ID ${id_ocorrencia}`);
                }
            }
            function closePopupsolucao() {
                var popup = document.getElementById("popupContainerSolucao");
                popup.style.display = "none";
                
                //Muda o display de popupDivFundo(div com a class="fundo") para none, "fechando" a div de fundo
                var popup = document.getElementById("popupDivFundo");
                popup.style.display = "none";
            }
            document.addEventListener('DOMContentLoaded', function () {
                var statusElements = document.querySelectorAll('.problema-info .status');
                statusElements.forEach(function (statusElement) {
                    if (statusElement.textContent.includes('1')) {
                        statusElement.innerHTML = '<strong>Status:</strong> <span class="em-andamento">Em andamento</span>';
                    } else {
                        statusElement.innerHTML = '<strong>Status:</strong> <span class="concluido">Concluído</span>';
                    }
                });
            });
        </script>
        
        <!--Controla a div com class="fundo" quando o botão Visualizar é clicado-->

    </div>
    </div>

    <div class="section" id="bottomRange">
        Aplicação Operação limpeza V0.1
    </div>

    <div class="section" id="rodape">
        <footer>
            <div class="centralizar rodape">
                PI-3 GRUPO-012 Sertãozinho-SP - UNIVESP
            </div>
        </footer>
    </div>

</body>

</html>